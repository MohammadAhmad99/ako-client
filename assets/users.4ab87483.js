import{u as F,c as W,h as X,O,Q as Y,T as Z,V as g,W as A,X as J,Y as ee,g as ue,Z as re,o as ne,_ as se,$ as ae,L as te,a0 as le,f as oe,a1 as ie,P as T}from"./index-69207e67.js";import{r as C,ar as ce,ao as de,ai as me,aF as he,ag as ge,ap as pe,aq as fe}from"./@chakra-ui/icons.bb373c7b.js";import{L as B}from"./LoadingList.7e2bed80.js";import{u as Ae,j as e,d as u,e as p,ae as $,g as Ce,h as xe,l as I,b as P,t as z,K as be,L as De,N as ve,O as Se,T as U,Q as Ee,D as Ie,R as Ue,S as N,F as v,f as S,z as E,U as Fe,B as _,m as x,ab as we,ag as ye,k as H}from"./@chakra-ui/react.4d46e3f3.js";import"./framer-motion.7561cd0c.js";const Re=()=>{const{userStore:n}=F(),o=Ae(),t=W(),a=async(m,l)=>{try{const s=await n.createUser(m,l);return o({title:"User created.",status:"info"}),s.data}catch(s){if(s.response)switch(s.response.status){case 422:o({title:`${s.response.data.errors[0].message}`,status:"error"});break;default:o({title:`${s.message}`,status:"error"});break}else t(s);return Promise.reject(s)}},{execute:i,...d}=X(a);return{createUser:i,...d}},Me=({isOpen:n,onClose:o,user:t})=>{const{userStore:a}=F(),{searchingRole:i,searchingPage:d,search:m}=C.exports.useContext(O),{deleteUser:l,isLoading:s}=Y(),{pagination:f}=a,b=async(r,D)=>{if(r)try{await l(D,{page:d,limit:f==null?void 0:f.per_page,role:i,search:m})}catch(w){console.error(w)}o()};return e(Z,{isOpen:n,isLoading:s,onClose:r=>b(r,t.id),title:"\u062A\u0623\u0643\u064A\u062F \u0627\u0644\u062D\u0630\u0641",message:`"${t.fullname}" \u0633\u064A\u062A\u0645 \u062D\u0630\u0641\u0647 \u0645\u0646 \u0627\u0644\u0646\u0638\u0627\u0645 \u062A\u0645\u0627\u0645\u0627\u064B.`,confirmMessage:"\u062D\u0630\u0641"})},_e=()=>{const{searchingRole:n,setSearchingRole:o,setSearchingPage:t,search:a,setSearch:i}=C.exports.useContext(O),d=l=>{t(1),o(l.target.value)},m=l=>{t(1),i(l.target.value)};return u(p,{flexBasis:"600px",children:[u($,{value:n,onChange:d,size:"sm",w:"full",mr:"2",children:[e("option",{value:"any",children:"\u0623\u064A \u0635\u0644\u0627\u062D\u064A\u0629"}),e("option",{value:g.ADMIN,children:"\u0645\u062F\u064A\u0631"}),e("option",{value:g.TEACHER,children:"\u0645\u062F\u0631\u0633"}),e("option",{value:g.STUDENT,children:"\u0637\u0627\u0644\u0628"})]}),u(Ce,{maxW:"400px",w:"full",size:"sm",children:[e(xe,{pointerEvents:"none",children:e(ce,{color:"gray.300"})}),e(I,{placeholder:"\u0627\u0628\u062D\u062B \u0639\u0646 \u0645\u0633\u062A\u062E\u062F\u0645...",value:a||"",onChange:m})]})]})},Oe=A.object().shape({first_name:A.string().required("\u0627\u0644\u0627\u0633\u0645 \u0627\u0644\u0627\u0648\u0644 \u0645\u0637\u0644\u0648\u0628"),last_name:A.string().required("\u0627\u0644\u0627\u0633\u0645 \u0627\u0644\u0627\u062E\u064A\u0631 \u0645\u0637\u0644\u0648\u0628"),login:A.string().required("\u0627\u0644\u0631\u0642\u0645 \u0645\u0637\u0644\u0648\u0628"),email:A.string().email("Email is invalid").required("Email field is required"),role:A.mixed().required("\u0644\u0627 \u064A\u0645\u0643\u0646 \u062A\u0631\u0643 \u0627\u0644\u0635\u0644\u0627\u062D\u064A\u0629 \u0641\u0627\u0631\u063A\u0629").oneOf(Object.values(g),`Available roles: ${Object.keys(g).join(", ")}`),password:A.string().required("Password field is required").min(6,"\u064A\u062C\u0628 \u0627\u0644\u0627 \u062A\u0642\u0644 \u0639\u0646 6 \u0645\u062D\u0627\u0631\u0641.")}),Le=()=>{const{userStore:n}=F(),{searchingRole:o,search:t}=C.exports.useContext(O),{createUser:a,isLoading:i}=Re(),{isOpen:d,onOpen:m,onClose:l}=P(),{register:s,handleSubmit:f,reset:b,formState:{errors:r}}=J({resolver:ee(Oe)}),{me:D}=n;return D===null?null:u(z,{children:[e(ue,{onClick:m}),u(be,{isOpen:d,onClose:l,children:[e(De,{}),e(ve,{children:u("form",{onSubmit:f(async L=>{var y,R;try{await a(L,{page:(y=n.pagination)==null?void 0:y.current_page,limit:(R=n.pagination)==null?void 0:R.per_page,role:o,search:t}),b(),l()}catch(k){console.error(k)}}),children:[e(Se,{children:u(p,{alignItems:"center",children:[e(re,{}),e(U,{ml:2,children:"\u0625\u0646\u0634\u0627\u0621 \u062D\u0633\u0627\u0628 \u062C\u062F\u064A\u062F"})]})}),e(Ee,{}),e(Ie,{}),e(Ue,{pb:6,children:u(N,{spacing:"4",children:[u(v,{isRequired:!0,children:[e(S,{children:"\u0627\u0644\u0627\u0633\u0645 \u0627\u0644\u0623\u0648\u0644"}),e(I,{placeholder:"First name",...s("first_name"),isInvalid:!!r.first_name}),r.first_name&&e(E,{color:"red.500",children:r.first_name.message})]}),u(v,{isRequired:!0,children:[e(S,{children:"\u0627\u0644\u0627\u0633\u0645 \u0627\u0644\u0623\u062E\u064A\u0631"}),e(I,{placeholder:"Last name",...s("last_name"),isInvalid:!!r.last_name}),r.last_name&&e(E,{color:"red.500",children:r.last_name.message})]}),u(v,{isRequired:!0,children:[e(S,{children:"\u0631\u0642\u0645 \u0627\u0644\u0647\u0627\u062A\u0641"}),e(I,{placeholder:"e.g student001",...s("login"),isInvalid:!!r.login}),r.login&&e(E,{color:"red.500",children:r.login.message})]}),u(v,{isRequired:!0,children:[e(S,{children:"\u0627\u0644\u0628\u0631\u064A\u062F \u0627\u0644\u0627\u0643\u062A\u0631\u0648\u0646\u064A"}),e(I,{placeholder:"example@email.com",...s("email"),isInvalid:!!r.email}),r.email&&e(E,{color:"red.500",children:r.email.message})]}),u(v,{isRequired:!0,children:[e(S,{children:"\u0627\u0644\u0635\u0644\u0627\u062D\u064A\u0629"}),u($,{w:"full",mr:"2",...s("role"),isInvalid:!!r.role,children:[e("option",{value:g.STUDENT,children:"\u0637\u0627\u0644\u0628"}),D.isAdmin&&u(z,{children:[e("option",{value:g.TEACHER,children:"\u0645\u062F\u0631\u0633"}),e("option",{value:g.ADMIN,children:"\u0623\u062F\u0645\u0646"})]})]}),r.role&&e(E,{color:"red.500",children:r.role.message})]}),u(v,{isRequired:!0,children:[e(S,{children:"\u0643\u0644\u0645\u0629 \u0627\u0644\u0645\u0631\u0648\u0631"}),e(I,{placeholder:"******",...s("password"),isInvalid:!!r.password}),e(E,{color:r.password?"red":"gray.500",children:r.password?r.password.message:"\u064A\u062C\u0628 \u0627\u0644\u0627 \u062A\u0642\u0644 \u0639\u0646 6 \u0645\u062D\u0627\u0631\u0641."})]})]})}),u(Fe,{children:[e(_,{type:"submit",variant:"outline",mr:3,colorScheme:"blue",isLoading:i,loadingText:"\u0625\u0646\u0634\u0627\u0621...",leftIcon:e(de,{}),children:"\u0625\u0646\u0634\u0627\u0621"}),e(_,{onClick:l,children:"\u0625\u0627\u0644\u063A\u0627\u0621"})]})]})})]})]})},ke=({render:n,limit:o})=>{const{userStore:t}=F(),{searchingRole:a,search:i,searchingPage:d,setSearchingPage:m}=C.exports.useContext(O),l=W(),[s,f]=C.exports.useState(null),[b,r]=C.exports.useState(null),{onOpen:D,onClose:w,isOpen:L}=P(),{onOpen:y,onClose:R,isOpen:k}=P(),{users:q,pagination:h,me:Q,isLoading:V}=t,G=c=>{r(c),D()},K=c=>{f(c),y()};if(C.exports.useEffect(()=>{t.loadUsersData({page:d,limit:o||(h==null?void 0:h.per_page),search:i,role:a}).catch(c=>l(c))},[l,t,i,a,d]),h===void 0||q===null||Q===null)return e(B,{});const j=Math.ceil(h.total/h.per_page);return u(x,{children:[b&&e(se,{user:b,isOpen:L,onClose:w}),s&&e(Me,{user:s,isOpen:k,onClose:R}),u(p,{justifyContent:"space-between",sx:{gap:"10px"},flexWrap:"wrap",children:[e(_e,{}),e(Le,{})]}),u(x,{children:[u(p,{mt:"5",p:"0 10px",fontWeight:"bold",alignItems:"center",justifyContent:"space-between",children:[u(U,{children:["\u0627\u0644\u0625\u062C\u0645\u0627\u0644\u064A: (",h.total,")"]}),e(U,{children:"\u0627\u0644\u0625\u062C\u0631\u0627\u0621\u0627\u062A"})]}),V?e(B,{}):e(N,{mt:"4",spacing:"2",children:q.map(c=>e(n,{user:c,onEdit:M=>G(M),onDelete:M=>K({id:M.id,fullname:M.fullname})},c.id))})]}),q.length===0&&e(x,{textAlign:"center",userSelect:"none",children:e(U,{color:"gray.500",children:"\u0644\u0627 \u064A\u0645\u0643\u0646 \u0625\u064A\u062C\u0627\u062F \u0623\u064A \u0645\u0633\u062A\u062E\u062F\u0645."})}),u(p,{margin:"2rem 0",flexDirection:{base:"column",sm:"column",md:"row"},children:[e(x,{textAlign:{base:"center",sm:"center",md:"left"},mb:{base:"2",md:"0"},children:u(U,{fontSize:"sm",children:["\u0627\u0644\u0635\u0641\u062D\u0629 ",e("b",{children:h.current_page})," \u0645\u0646 ",j]})}),u(p,{ml:"auto",mr:"auto",justifyContent:"center",flexWrap:"wrap",alignItems:"center",sx:{gap:"30px"},children:[e(_,{onClick:()=>m(c=>c-1),disabled:h.current_page<=1,variant:"link",leftIcon:e(me,{}),children:"\u0627\u0644\u0635\u0641\u062D\u0629 \u0627\u0644\u0633\u0627\u0628\u0642\u0629"}),e(_,{onClick:()=>m(c=>c+1),disabled:h.current_page===j,variant:"link",rightIcon:e(he,{}),children:"\u0627\u0644\u0635\u0641\u062D\u0629 \u0627\u0644\u062A\u0627\u0644\u064A\u0629"})]})]})]})};var qe=ne(ke);const Te=({user:n,onEdit:o,onDelete:t})=>{const{userStore:{me:a}}=F(),i=(()=>a!==null&&a.id===n.id?!0:ae(n.roles,[g.ADMIN,g.TEACHER])&&a!==null?!!(a.isTeacher||a.isStudent):!1)();return e(x,{borderBottomWidth:"1px",borderRadius:"lg",w:"full",p:"3",bg:ge("gray.50","gray.700"),children:u(p,{flexDir:{base:"column",sm:"row"},alignItems:"center",sx:{gap:"20px"},children:[u(p,{alignItems:"center",flexDir:{base:"column",sm:"row"},flex:"1 1 0",children:[e(we,{name:n.fullname,size:"sm",ml:{base:"0",sm:"3"},mb:{base:"1",sm:"0"}}),u(x,{textAlign:{base:"center",sm:"right"},children:[e(ye,{as:te,to:`/user/${n.id}`,fontSize:"md",fontWeight:"medium",children:n.fullname}),e(U,{fontSize:"sm",overflowWrap:"anywhere",children:n.email})]})]}),e(p,{sx:{gap:"5px"},justifyContent:"center",flex:"1 1 0",children:e(le,{roles:n.roles})}),u(x,{children:[e(H,{size:"sm",disabled:i,onClick:()=>o(n),"aria-label":"\u062A\u0639\u062F\u064A\u0644",variant:"ghost",mr:1,icon:e(pe,{})}),e(H,{size:"sm",disabled:i,onClick:()=>t(n),colorScheme:"red","aria-label":"\u062D\u0630\u0641",variant:"ghost",icon:e(fe,{})})]})]})})},We=()=>{const{userStore:{me:n}}=F();return n===null?e(oe,{}):e(ie,{children:u(T,{children:[e(T.Heading,{heading:"\u0625\u062F\u0627\u0631\u0629 \u0627\u0644\u0645\u0633\u062A\u062E\u062F\u0645\u064A\u0646",description:"\u064A\u0645\u0643\u0646\u0643 \u0625\u0636\u0627\u0641\u0629 \u0623\u0648 \u062A\u0639\u062F\u064A\u0644 \u0627\u0644\u0645\u0633\u062A\u062E\u062F\u0645\u064A\u0646 \u0645\u0646 \u0647\u0646\u0627 ."}),e(T.Content,{mt:"5",children:e(qe,{render:Te,limit:6})})]})})};export{We as default};
